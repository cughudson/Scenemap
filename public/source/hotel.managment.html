<html>
<head>
    <title>中国-江西-靖安-民宿</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width,  initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" type="text/css" href="../css/component.css"/>
    <link rel="stylesheet" type="text/css" href="../css/page.css"/>
    <link rel="stylesheet" type="text/css" href="../css/quilljs.snow.editor.css"/>
    <link rel='stylesheet' type='text/css' href='../css/semantic.min.css'/>
    <!-- <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=cUWciM1b3cacMFaSKRgTGT9W5yfh7RF7"></script> -->
    <script type="text/javascript" src="../plugin/quill/quill.js"></script>
    <script type="text/javascript" src="../js/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="../js/jquery-ui.min.js"></script>
    <script type='text/javascript' src='../js/semantic.js'></script>
    <script type="text/javascript" src="../js/common.js"></script>
</head>
<body>
<div class="managment toolbar">
    <div class="hu-ui menu-item active">
            <span class="icon">
                <i class="icon leaf"></i>
            </span>
        <span class="data">新建景点</span>
    </div>
    <div class="hu-ui menu-item">
            <span class="icon">
                <i class="ui icon cube"></i>
            </span>
        <span class="data">新建民宿</span>
    </div>
    <div class="hu-ui menu-item">
            <span class="icon">
                <i class="icon world"></i>
            </span>
        <span class="data">景点管理</span>
    </div>
    <div class="hu-ui menu-item">
            <span class="icon">
                <i class="icon cubes"></i>
            </span>
        <span class="data">民宿管理</span>
    </div>
    <!--暂时不实现  -->
    <div class="hu-ui menu-item">
            <span class="icon">
                <i class="icon connectdevelop"></i>
            </span>
        <span class="data">运行状态</span>
    </div>
    <div class="hu-ui menu-item">
            <span class="icon">
                <i class="icon settings"></i>
            </span>
        <span class="data">系统管理</span>
    </div>
</div>
<main class="managment-wrapper">
    <header class='clearfix'>
        <div class="hu-ui user">
            <img class="portrait" src="../resource/image/bg.jpg">
            <a class="header" href='javascript:void(0)'>邱夕燕</a>
            <a class=''>退出</a>
        </div>
    </header>
    <div class="managment">
        <section id='tab-group'>
            <div class="table-header">
                <div class="ui top attached tabular menu">
                    <a class="item active">已发布</a>
                    <a class="item">草稿箱</a>
                    <a class="item">回收箱</a>
                    <div class='button-group'>
                        <div class='reflesh button' id='reflesh'>
                            <i class='icon refresh'></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class='table-wrapper'>
                <table class="ui celled table" data-currentpage=4 data-maxpage=36>
                    <thead>
                    <tr>
                        <th>序列</th>
                        <th>标题</th>
                        <th>作者</th>
                        <th>创建时间</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>1</td>
                        <td></td>
                        <td>Cell</td>
                        <td>Cell</td>
                        <td class='action'>
                            <a class='hu-ui action-text' href='https://www.baidu.com' target='_blank'>编辑</a>
                            <span class='hu-ui action-text' data-action='pull'>撤回</span>
                            <span class='hu-ui action-text' data-action='delete'>删除</span>
                        </td>
                    </tr>
                    <tr data-id='12345'>
                        <td>2</td>
                        <td>Cell</td>
                        <td>Cell</td>
                        <td>Cell</td>
                        <td class='action'>
                            <span class='hu-ui action-text'>编辑</span>
                            <span class='hu-ui action-text'>撤回</span>
                            <span class='hu-ui action-text'>删除</span>
                        </td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Cell</td>
                        <td>Cell</td>
                        <td>Cell</td>
                        <td class='action'>
                            <span class='hu-ui action-text'>编辑</span>
                            <span class='hu-ui action-text'>撤回</span>
                            <span class='hu-ui action-text'>删除</span>
                        </td>
                    </tr>
                    <tr>
                        <td colspan='5'>
                            <div class="ui active centered inline loader"></div>
                        </td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <th colspan="5">
                            <div class='meta-data'>
                                共发布景点**个，共*页
                            </div>
                            <div class="ui right floated pagination menu">
                                <a class="icon item" id="prevPage">
                                    <i class="left chevron icon"></i>
                                </a>
                                <a class="item" data-page=1>1</a>
                                <a class="item active" data-page=2>2</a>
                                <a class="item" data-page=3>3</a>
                                <a class="item" data-page=4>4</a>
                                <a class="item" data-page=5>5</a>
                                <a class="icon item" id='nextPage'>
                                    <i class="right chevron icon"></i>
                                </a>
                            </div>
                        </th>
                    </tr>
                    </tfoot>
                </table>
            </div>
            <div class="ui message positive">
                <div class='header'>注意事项</div>
                <p>单击删除按钮并不会将数据从数据库中直接删除，而是会将数据保存到回收箱中，如果需要将数据从数据库中删除，请到清空回收箱或在回收箱中删除数据</p>
                <i class='ui icon close'></i>
            </div>
        </section>
    </div>
</main>
<script type='text/javascript'>
    $(function () {
        /**
         *    0 is represent culture scene
         *    1 is represent nature scene
         **/
        $(document).on('click', ".pagination .item", function (evt) {
            var that = $(this);
            var sceneType = $('#scenetype')[0].checked ? 0 : 1;
            var currentPage = $('.pagination .active').data('page');
            var currentActiveItem = $('.pagination .active');
            var maxPage = $('table').data('maxpage');
            $('.pagination .item').removeClass('active');
            if (that.attr('id') == 'nextPage') {
                //如果当前页为最后一页
                if (currentPage == maxPage) {
                    alert('已经是最后一页了');
                    currentActiveItem.addClass('active');
                    $("#prevPage").insertAfter(DomStr);

                } else {
                    //如果当前页为当前索引的最后一页
                    if (currentActiveItem.next().hasClass('icon')) {
                        var DomStr = Regernatepagination(0, currentPage + 1, maxPage);
                        if (DomStr.change) {
                            $(".pagination").children().remove();
                            $(".pagination").append(DomStr.DomString);
                        }
                    } else {
                        currentActiveItem.next().addClass('active');
                    }
                    FetchData(sceneType, currentPage + 1);
                }

            } else if (that.attr('id') == 'prevPage') {
                //如果当前页为最后一页
                if (currentPage == 1) {
                    alert("已经是第一页了");
                    currentActiveItem.addClass('active');

                } else {
                    //如果当前页为当前索引的第一页
                    if (currentActiveItem.prev().hasClass('icon')) {
                        var DomStr = Regernatepagination(1, currentPage - 1, maxPage);
                        if (DomStr.change) {
                            $(".pagination").children().remove();
                            $(".pagination").append(DomStr.DomString);
                        }
                    } else {
                        currentActiveItem.prev().addClass('active');
                    }
                    FetchData(sceneType, currentPage - 1);
                }

            } else {
                if (that.hasClass('active')) return;
                that.addClass('active');
                var pageNum = that.data('page');
                var DomStr = Regernatepagination(2, that.data('page'), maxPage);
                if (DomStr.change) {
                    $(".pagination").children().remove();
                    $(".pagination").append(DomStr.DomString);
                }
                FetchData(sceneType, pageNum);
            }
        });

        var Regernatepagination = function (type, currentPageNum, maxPage) {
            // type
            //  0 is next page
            //  1 is prev page
            //  2 is number page
            // init with head prevPage
            var DomString = '<a class="icon item" id="prevPage"><i class="left chevron icon" ></i></a >';
            var arr = null;
            switch (type) {
                case 0:
                    arr = [currentPageNum - 4, currentPageNum - 3, currentPageNum - 2, currentPageNum - 1, currentPageNum];
                    break;
                case 1:
                    arr = [currentPageNum, currentPageNum + 1, currentPageNum + 2, currentPageNum + 3, currentPageNum + 4];
                    break;
                case 2:
                    if (currentPageNum + 2 >= maxPage) {
                        arr = [maxPage - 4, maxPage - 3, maxPage - 2, maxPage - 1, maxPage];
                    } else if (currentPageNum - 2 <= 1) {
                        arr = [1, 2, 3, 4, 5];
                    } else {
                        arr = [currentPageNum - 2, currentPageNum - 1, currentPageNum, currentPageNum + 1, currentPageNum + 2];
                    }
                    break;
                default:
                    arr = []
            }
            arr.forEach(item => {
                console.log(item);
                if (item == currentPageNum) {
                    DomString += "<a class='item active' data-page=" + item + ">" + item + "</ a>";
                } else {
                    DomString += "<a class='item' data-page=" + item + ">" + item + "</ a>";
                }
            });
            DomString += '<a class="icon item" id="nextPage"><i class="right chevron icon"></i></a>';
            if (arr.length == 0) change = false;
            else change = true;
            return {"change": change, 'DomString': DomString};
        };
        //reflesh data;
        $("#reflesh").on('click', function (evt) {
            var sceneType = $('#scenetype')[0].checked ? 0 : 1;
            var currentPage = $(".pagination .active").data('page');
            FetchData(sceneType, currentPage);
        });
        $("input[type='radio']").on('click', function (evt) {
            var sceneType = $('#scenetype')[0].checked ? 0 : 1;
            var currentPage = $(".pagination .active").data('page');
            FetchData(sceneType, currentPage);
        });
        //action
        $(document).on('click', '.action span', function () {
            var id = $(this).parents('tr').data('id');
            var actionType = $(this).data('action');
            switch (actionType) {
                case 'pull':
                    $.post('../action.php', {'id': id}, function (respondData) {
                        var Data = JSON.parse(respondData);
                        if (Data.status) {
                            alert("操作成功");
                        } else {
                            alert("操作失败");
                        }
                    });
                    break;
                case 'delete':
                    $.post('../action.php', {'id': id}, function (respondData) {
                        var Data = JSON.parse(respondData);
                        if (Data.status) {
                            alert("操作成功");
                        } else {
                            alert("操作失败");
                        }
                    });
                    break;
                default:
                    alert('未知操作');
            }
        });

        var FetchData = function (sceneType, page) {
            $.post("../fetchData.php", {type: sceneType, page: page}, function (respondData) {
                var Data = JSON.parse(respondData);
                if (Data.status) {
                    $("#loader").remove();
                    $("table tbody").append(Data.html);
                } else {
                    $("#loader").remove();
                    var str = ' <tr><td colspan = 5 ><div class="ui message error"><p>加载数据失败</p></div></td ></tr >';
                }
            });
        }
    })
</script>
</body>
</html>